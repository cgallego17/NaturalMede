{% extends 'custom_admin/base.html' %}
{% load static %}

{% block title %}{{ customer.full_name }} - Detalle Cliente{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-user"></i> {{ customer.full_name }}</h2>
                <div class="btn-group">
                    <a href="{% url 'custom_admin:admin_customer_edit' customer.pk %}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                    <a href="{% url 'custom_admin:admin_customers' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver
                    </a>
                </div>
            </div>

            <!-- Informaci√≥n del Cliente -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-info-circle"></i> Informaci√≥n Personal</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Nombre:</strong> {{ customer.user.first_name }} {{ customer.user.last_name }}</p>
                                    <p><strong>Email:</strong> {{ customer.user.email }}</p>
                                    <p><strong>Usuario:</strong> {{ customer.user.username }}</p>
                                    <p><strong>Tipo:</strong> 
                                        <span class="badge badge-{% if customer.customer_type == 'vip' %}warning{% else %}info{% endif %}">
                                            {{ customer.get_customer_type_display }}
                                        </span>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Documento:</strong> {{ customer.document_type }}: {{ customer.document_number }}</p>
                                    <p><strong>Tel√©fono:</strong> {{ customer.phone }}</p>
                                    <p><strong>Ciudad:</strong> {{ customer.city }}</p>
                                    <p><strong>Canal:</strong> 
                                        {% if customer.channel == 'instagram' %}
                                            <span class="badge badge-info">üì∏ Instagram</span>
                                        {% elif customer.channel == 'facebook' %}
                                            <span class="badge badge-primary">üë• Facebook</span>
                                        {% elif customer.channel == 'whatsapp' %}
                                            <span class="badge badge-success">üí¨ WhatsApp</span>
                                        {% elif customer.channel == 'google' %}
                                            <span class="badge badge-warning">üîç Google</span>
                                        {% elif customer.channel == 'referral' %}
                                            <span class="badge badge-secondary">üë§ Referido</span>
                                        {% elif customer.channel == 'walk_in' %}
                                            <span class="badge badge-dark">üè™ Tienda f√≠sica</span>
                                        {% elif customer.channel == 'website' %}
                                            <span class="badge badge-info">üåê Sitio web</span>
                                        {% elif customer.channel == 'email' %}
                                            <span class="badge badge-light">üìß Email</span>
                                        {% elif customer.channel == 'phone' %}
                                            <span class="badge badge-primary">üìû Tel√©fono</span>
                                        {% else %}
                                            <span class="badge badge-secondary">‚ùì Otro</span>
                                        {% endif %}
                                    </p>
                                    <p><strong>Estado:</strong> 
                                        {% if customer.is_active %}
                                            <span class="badge badge-success">Activo</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Inactivo</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <p><strong>Direcci√≥n:</strong> {{ customer.address }}</p>
                                    {% if customer.birth_date %}
                                        <p><strong>Fecha de Nacimiento:</strong> {{ customer.birth_date|date:"d/m/Y" }}</p>
                                    {% endif %}
                                    {% if customer.notes %}
                                        <p><strong>Notas:</strong> {{ customer.notes }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar"></i> Estad√≠sticas</h5>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <h3 class="text-primary">{{ total_orders }}</h3>
                                <p class="mb-0">√ìrdenes Web</p>
                            </div>
                            <div class="text-center mb-3">
                                <h3 class="text-success">{{ total_pos_sales }}</h3>
                                <p class="mb-0">Ventas POS</p>
                            </div>
                            <div class="text-center mb-3">
                                <h3 class="text-warning">${{ total_spent|floatformat:0 }}</h3>
                                <p class="mb-0">Total Gastado (Web)</p>
                            </div>
                            <div class="text-center">
                                <h3 class="text-info">${{ total_pos_spent|floatformat:0 }}</h3>
                                <p class="mb-0">Total Gastado (POS)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √ìrdenes Recientes -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-shopping-cart"></i> √ìrdenes Web Recientes</h5>
                        </div>
                        <div class="card-body">
                            {% for order in orders %}
                            <div class="d-flex justify-content-between align-items-center mb-3 p-2 border-left border-primary">
                                <div>
                                    <strong>#{{ order.order_number }}</strong>
                                    <br><small class="text-muted">{{ order.created_at|date:"d/m/Y H:i" }}</small>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-{% if order.status == 'delivered' %}success{% elif order.status == 'paid' %}primary{% elif order.status == 'pending' %}warning{% else %}secondary{% endif %}">
                                        {{ order.get_status_display }}
                                    </span>
                                    <br><small class="text-muted">${{ order.total|floatformat:0 }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted text-center">No hay √≥rdenes web</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-cash-register"></i> Ventas POS Recientes</h5>
                        </div>
                        <div class="card-body">
                            {% for sale in pos_sales %}
                            <div class="d-flex justify-content-between align-items-center mb-3 p-2 border-left border-success">
                                <div>
                                    <strong>#{{ sale.sale_number }}</strong>
                                    <br><small class="text-muted">{{ sale.created_at|date:"d/m/Y H:i" }}</small>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-success">Pagado</span>
                                    <br><small class="text-muted">${{ sale.total|floatformat:0 }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted text-center">No hay ventas POS</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones R√°pidas -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-tools"></i> Acciones R√°pidas</h5>
                        </div>
                        <div class="card-body">
                            <div class="btn-group" role="group">
                                <a href="{% url 'custom_admin:admin_customer_orders' customer.pk %}" class="btn btn-info">
                                    <i class="fas fa-list"></i> Ver Todas las √ìrdenes
                                </a>
                                {% if customer.customer_type == 'normal' %}
                                    <a href="{% url 'custom_admin:admin_customer_toggle_vip' customer.pk %}" class="btn btn-warning">
                                        <i class="fas fa-crown"></i> Hacer VIP
                                    </a>
                                {% else %}
                                    <a href="{% url 'custom_admin:admin_customer_toggle_vip' customer.pk %}" class="btn btn-secondary">
                                        <i class="fas fa-user"></i> Quitar VIP
                                    </a>
                                {% endif %}
                                {% if customer.is_active %}
                                    <a href="{% url 'custom_admin:admin_customer_toggle_status' customer.pk %}" class="btn btn-danger">
                                        <i class="fas fa-ban"></i> Desactivar
                                    </a>
                                {% else %}
                                    <a href="{% url 'custom_admin:admin_customer_toggle_status' customer.pk %}" class="btn btn-success">
                                        <i class="fas fa-check"></i> Activar
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
